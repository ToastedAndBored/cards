<div id="card-component" style="background-color: red">
    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è QR-—Ä–µ–∂–∏–º–æ–º -->
    <div class="qr-controls" style="display: none">
        <button class="toggle-qr-button" id="toggleQR">üîÄ</button>
        <button class="close-qr-button" id="closeQR" style="display: none">
            ‚úï
        </button>
    </div>

    <!-- Is hidden block -->
    {{ if .Card.Fields.IsHidden }}
    <div class="hidden-flag">{{ T "HiddenCard" .Lang }}</div>
    {{ end }}
    <div
        class="logo-container"
        id="logo-container"
        hide-when-no-content="#card-logo"
    >
        {{if .Card.Logo}}
        <img
            id="card-logo"
            src="/{{.Card.Logo}}"
            alt="Company logo"
            preview-for="#input-logo"
            initial-sync="no"
            style="background-color: white"
        />
        {{else}}
        <img
            id="card-logo"
            src=""
            alt="Company logo"
            preview-for="#input-logo"
            initial-sync="no"
            style="background-color: white"
        />
        {{end}}
    </div>
    <hr />
    <button>{{ T "AddToContacts" .Lang }}</button>
    <div class="avatar" hide-when-no-content="#card-image-preview">
        {{if .Card.Avatar}}
        <img
            id="card-image-preview"
            src="/{{.Card.Avatar}}"
            alt="Your avatar preview"
            preview-for="#input-avatar"
            initial-sync="no"
            style="background-color: white"
        />
        {{else}}
        <img
            id="card-image-preview"
            src=""
            alt="Your avatar preview"
            preview-for="#input-avatar"
            initial-sync="no"
            style="background-color: white"
        />
        {{end}}
    </div>
    <h2 id="card-name" preview-for="#input-name">{{ .Card.Fields.Name }}</h2>
    <div>
        <div preview-for="#input-position">{{ .Card.Fields.Position }}</div>
        <div preview-for="#input-company">{{ .Card.Fields.Company }}</div>
    </div>
    <div hide-when-no-content="#card-description">
        <pre id="card-description" preview-for="#input-description">
{{ .Card.Fields.Description }}</pre
        >
    </div>
    <div class="contact-block">
        <div hide-when-no-content="#phone-span">
            {{ if .Card.Fields.Phone }}
            <a
                href="tel:{{.Card.Fields.Phone}}"
                title="Phone"
                preview-for="#input-phone"
                preview-prefix="tel:"
                >üìû</a
            >
            <span preview-for="#input-phone" id="phone-span"
                >{{.Card.Fields.Phone}}</span
            >
            {{else}}
            <a
                href=""
                title="Phone"
                preview-for="#input-phone"
                preview-prefix=""
                >üìû</a
            >
            <span preview-for="#input-phone" id="phone-span"></span>
            {{end}}
        </div>
        <div hide-when-no-content="#email-span">
            {{ if .Card.Fields.Email }}
            <a
                href="mailto:{{.Card.Fields.Email}}"
                title="Email"
                preview-for="#input-email"
                preview-prefix="mailto:"
                >‚úâÔ∏è</a
            >
            <span preview-for="#input-email" id="email-span"
                >{{.Card.Fields.Email}}</span
            >
            {{else}}
            <a
                href=""
                title="Email"
                preview-for="#input-email"
                preview-prefix="mailto:"
                >‚úâÔ∏è</a
            >
            <span preview-for="#input-email" id="email-span"></span>
            {{end}}
        </div>
        <div hide-when-no-content="#telegram-span">
            {{ if .Card.Fields.Telegram }}
            <a
                href="https://t.me/{{.Card.Fields.Telegram}}"
                title="Telegram"
                preview-for="#input-telegram"
                preview-prefix="https://t.me/"
                >üì®</a
            >
            <span
                preview-for="#input-telegram"
                preview-prefix="@"
                id="telegram-span"
                >@{{.Card.Fields.Telegram}}</span
            >
            {{else}}
            <a
                href=""
                title="Telegram"
                preview-for="#input-telegram"
                preview-prefix="https://t.me/"
                >üì®</a
            >
            <span
                preview-for="#input-telegram"
                preview-prefix="@"
                id="telegram-span"
            ></span>
            {{end}}
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è QR-–∫–æ–¥–æ–≤ -->
    <div id="userQRContainer" class="qr-container" style="display: none">
        <div class="qr-content">
            <h3>{{ T "CardLinkQR" .Lang }}</h3>
            <div class="qr-image-container">
                <img id="user-qr-image" class="qr-image" alt="QR Code" />
            </div>
            <p>{{ T "ScanToView" .Lang }}</p>
        </div>
    </div>

    <div id="vcardQRContainer" class="qr-container" style="display: none">
        <div class="qr-content">
            <h3>{{ T "ContactQR" .Lang }}</h3>
            <div class="qr-image-container">
                <img id="vcard-qr-image" class="qr-image" alt="QR Code" />
            </div>
            <p>{{ T "ScanToSave" .Lang }}</p>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cardComponent = document.getElementById("card-component");
        const mainContent = document.getElementById("main-content");
        const qrContainers = document.querySelectorAll(".qr-container");

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏
        function updateCardHeight() {
            const windowHeight = window.innerHeight;
            const maxCardHeight = windowHeight * 0.9; // 90% –≤—ã—Å–æ—Ç—ã –æ–∫–Ω–∞

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            cardComponent.style.maxHeight = "";
            cardComponent.style.overflowY = "";

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –≤—ã—Å–æ—Ç—É –∫–∞—Ä—Ç–æ—á–∫–∏
            const currentHeight = cardComponent.offsetHeight;

            if (currentHeight > maxCardHeight) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –∏ —Å–∫—Ä–æ–ª–ª
                cardComponent.style.maxHeight = maxCardHeight + "px";
                cardComponent.style.overflowY = "auto";

                // –î–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–∫–∂–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
                mainContent.style.maxHeight = maxCardHeight - 40 + "px";
                mainContent.style.overflowY = "auto";

                qrContainers.forEach((container) => {
                    container.style.maxHeight = maxCardHeight - 40 + "px";
                    container.style.overflowY = "auto";
                });
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞
        updateCardHeight();
        window.addEventListener("resize", updateCardHeight);

        // –¢–∞–∫–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –∫–∞—Ä—Ç–æ—á–∫–∏
        new ResizeObserver(updateCardHeight).observe(cardComponent);
    });
</script>

<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    #card-component {
        flex: none;
        width: 350px;
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        background: var(--nav-bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
        position: relative;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .qr-controls {
        display: flex;
        justify-content: space-between;
        width: 100%;
        padding: 0 5px 10px 5px;
        border-bottom: 1px solid #ddd;
    }

    .toggle-qr-button,
    .close-qr-button {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .close-qr-button {
        background: #ff4d4d;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ QR-–∫–æ–¥–æ–≤ */
    .qr-container {
        display: none;
        width: 100%;
        padding: 15px 0;
        box-sizing: border-box;
    }

    .qr-content {
        text-align: center;
        width: 100%;
    }

    .qr-content h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 1.2rem;
    }

    .qr-content p {
        margin: 15px 0 0 0;
        color: #666;
        font-size: 0.9rem;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è QR-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
    .qr-image-container {
        width: 100%;
        max-width: 350px;
        margin: 0 auto;
    }

    .qr-canvas {
        width: 100%;
        height: auto;
        background: white;
        padding: 10px;
        border-radius: 8px;
        display: block;
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        -ms-interpolation-mode: nearest-neighbor;
    }

    /* –°—Ç–∏–ª–∏ –ª–æ–≥–æ—Ç–∏–ø–∞ */
    #card-component .logo-container {
        width: auto;
        max-width: 100%;
        height: auto;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    #card-component .logo-container img {
        border-radius: 0;
        width: auto;
        max-width: 120px;
        height: auto;
        max-height: 80px;
        object-fit: contain;
    }

    /* –°—Ç–∏–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞ */
    #card-component .avatar {
        width: 100%;
        overflow: hidden;
        border: 1px solid #777;
        border-radius: 5px !important;
    }

    #card-component .avatar img {
        display: block !important;
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        border-radius: 5px !important;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    #card-component h2,
    #card-component div {
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        word-break: break-word;
        white-space: normal;
        margin: 0.2rem 0;
    }

    /* –ë–ª–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è */
    #card-component #card-description {
        white-space: pre-wrap;
        word-break: break-word;
        width: 100%;
        max-height: 150px;
        overflow-y: auto;
        font-family: inherit;
        margin: 0.5rem 0;
    }

    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    #card-component hr {
        width: 100%;
    }

    /* –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –±–ª–æ–∫ */
    .contact-block div {
        display: flex;
        align-items: center;
        width: 100%;
        margin: 0.3rem 0;
    }

    .contact-block span {
        flex: 1;
        word-break: break-all;
        padding-left: 5px;
    }
</style>

<script src="/static/collapse.js"></script>
