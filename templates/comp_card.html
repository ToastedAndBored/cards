<div id="card-component">
    <div class="qr-controls" style="display: none">
        <button class="toggle-qr-button" id="toggleQR">
            <img src="/static/qr-code-.svg" style="scale: 0.049;">
        </button>
        <button class="close-qr-button" id="closeQR" style="display: none">
           <img src="/static/close.svg" style="scale: 0.5; margin: -1rem;">
        </button>
    </div>

    <!-- Is hidden block -->
    {{ if .Card.Fields.IsHidden }}
    <div class="hidden-flag">{{ T "HiddenCard" .Lang }}</div>
    {{ end }}
    <div id="main-content">
    <div
        class="logo-container"
        id="logo-container"
        hide-when-no-content="#card-logo"
    >
        {{if .Card.Logo}}
        <img
            id="card-logo"
            src="/{{.Card.Logo}}"
            alt="Company logo"
            preview-for="#input-logo"
            initial-sync="no"
            style="background-color: white"
        />
        {{else}}
        <img
            id="card-logo"
            src=""
            alt="Company logo"
            preview-for="#input-logo"
            initial-sync="no"
            style="background-color: white"
        />
        {{end}}
    </div>
    <hr />
    <button>{{ T "AddToContacts" .Lang }}</button>
    <div class="avatar" hide-when-no-content="#card-image-preview">
        {{if .Card.Avatar}}
        <img
            id="card-image-preview"
            src="/{{.Card.Avatar}}"
            alt="Your avatar preview"
            preview-for="#input-avatar"
            initial-sync="no"
            style="background-color: white"
        />
        {{else}}
        <img
            id="card-image-preview"
            src=""
            alt="Your avatar preview"
            preview-for="#input-avatar"
            initial-sync="no"
            style="background-color: white"
        />
        {{end}}
    </div>
    <h2 id="card-name" preview-for="#input-name">{{ .Card.Fields.Name }}</h2>
    <div class="card-contacts">
        <div preview-for="#input-position">{{ .Card.Fields.Position }}</div>
        <div preview-for="#input-company">{{ .Card.Fields.Company }}</div>
    </div>
    <div hide-when-no-content="#card-description" id="card-description" preview-for="#input-description">
{{ .Card.Fields.Description }}
    </div>
    <div class="contact-block">
        <div hide-when-no-content="#phone-span" id="phone-contact">
            {{ if .Card.Fields.Phone }}
            <a
                href="tel:{{.Card.Fields.Phone}}"
                title="Phone"
                preview-for="#input-phone"
                preview-prefix="tel:"
                >üìû</a
            >
            <span preview-for="#input-phone" id="phone-span"
                >{{.Card.Fields.Phone}}</span
            >
            {{else}}
            <a
                href=""
                title="Phone"
                preview-for="#input-phone"
                preview-prefix=""
                >üìû</a
            >
            <span preview-for="#input-phone" id="phone-span"></span>
            {{end}}
        </div>
        <div hide-when-no-content="#email-span" id="email-contact">
            {{ if .Card.Fields.Email }}
            <a
                href="mailto:{{.Card.Fields.Email}}"
                title="Email"
                preview-for="#input-email"
                preview-prefix="mailto:"
                >‚úâÔ∏è</a
            >
            <span preview-for="#input-email" id="email-span"
                >{{.Card.Fields.Email}}</span
            >
            {{else}}
            <a
                href=""
                title="Email"
                preview-for="#input-email"
                preview-prefix="mailto:"
                >‚úâÔ∏è</a
            >
            <span preview-for="#input-email" id="email-span"></span>
            {{end}}
        </div>
        <div hide-when-no-content="#telegram-span" id="telegram-contact">
            {{ if .Card.Fields.Telegram }}
            <a
                href="https://t.me/{{.Card.Fields.Telegram}}"
                title="Telegram"
                preview-for="#input-telegram"
                preview-prefix="https://t.me/"
                >üì®</a
            >
            <spantemplates/comp_card copy.html
                preview-for="#input-telegram"
                preview-prefix="@"
                id="telegram-span"
                >@{{.Card.Fields.Telegram}}</span
            >
            {{else}}
            <a
                href=""
                title="Telegram"
                preview-for="#input-telegram"
                preview-prefix="https://t.me/"
                >üì®</a
            >
            <span
                preview-for="#input-telegram"
                preview-prefix="@"
                id="telegram-span"
            ></span>
            {{end}}
        </div>
    </div>
    </div>


    <div id="userQRContainer" class="qr-container" style="display: none">
        <div class="qr-content">
            <h3>{{ T "CardLinkQR" .Lang }}</h3>
            <div class="qr-image-container">
                <img id="user-qr-image" class="qr-image" alt="QR Code" />
            </div>
            <h4>{{ T "ScanToView" .Lang }}</h4>
        </div>
    </div>

    <div id="vcardQRContainer" class="qr-container" style="display: none">
        <div class="qr-content">
            <h3>{{ T "ContactQR" .Lang }}</h3>
            <div class="qr-image-container">
                <img id="vcard-qr-image" class="qr-image" alt="QR Code" />
            </div>
            <h4>{{ T "ScanToSave" .Lang }}</h4>
        </div>
    </div>
    {{ if .Owner }}
        {{if .EditUrl }}
            <a href="{{.EditUrl }}">{{ T "EditCard" .Lang }}</a>
        {{end}}
    {{end}}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const toggleBtn = document.getElementById("toggleQR");
    const closeBtn = document.getElementById("closeQR");

    if (!toggleBtn || !closeBtn) return;


    const toggleImg = toggleBtn.querySelector("img");
    const closeImg = closeBtn.querySelector("img");

    if (!toggleImg || !closeImg) return;


    const originalToggleSrc = "/static/qr-code-.svg";
    const originalToggleScale = "0.049";
    const newToggleSrc = "/static/contact.svg";

    const originalCloseSrc = "/static/close.svg";
    const originalCloseScale = "0.5";
    const originalCloseMargin = "-1rem";


    let isContactIcon = false;


    function resetToggleButton() {
        toggleImg.src = originalToggleSrc;
        toggleImg.style.scale = originalToggleScale;
        isContactIcon = false;
    }


    toggleBtn.addEventListener("click", function() {
        if (isContactIcon) {

            resetToggleButton();
        } else {

            toggleImg.src = newToggleSrc;
            toggleImg.style.scale = originalToggleScale;
            isContactIcon = true;
        }
    });


    closeBtn.addEventListener("click", function() {

        resetToggleButton();


        closeImg.src = originalCloseSrc;
        closeImg.style.scale = originalCloseScale;
        closeImg.style.margin = originalCloseMargin;
    });
    console.log('dasdadsad');


    new MutationObserver(function(mutations) {
        mutations.forEach(mutation => {
            if (mutation.attributeName === 'style') {
                const displayStyle = window.getComputedStyle(closeBtn).display;
                if (displayStyle === 'none') {
                    resetToggleButton();
                }
            }
        });
    }).observe(closeBtn, { attributes: true });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {

    function findContactElement(block) {

        const contactId = block.id.replace('-contact', '-span');
        let contactElement = document.getElementById(contactId);


        if (!contactElement) {
            contactElement = block.querySelector('span, spantemplates');
        }

        return contactElement;
    }


    const contactBlocks = document.querySelectorAll('.contact-block > div');

    contactBlocks.forEach(block => {

        const contactElement = findContactElement(block);
        if (!contactElement) return;


        const copyIcon = document.createElement('img');
        copyIcon.src = '/static/download.svg';
        copyIcon.className = 'copy-icon';
        copyIcon.title = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞';


        contactElement.parentNode.insertBefore(copyIcon, contactElement.nextSibling);


        copyIcon.addEventListener('click', function() {

            let textToCopy = contactElement.textContent;


            const contactType = block.id.split('-')[0];


            if (contactType === 'telegram' && textToCopy.startsWith('@')) {
                textToCopy = textToCopy.substring(1);
            }


            navigator.clipboard.writeText(textToCopy).then(() => {

                const originalSrc = copyIcon.src;
                copyIcon.src = '/static/check.svg';

                setTimeout(() => {
                    copyIcon.src = originalSrc;
                }, 2000);
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            });
        });
    });
});
</script>

<!-- <script>
document.addEventListener("DOMContentLoaded", function() {
    console.log("Card height adjustment script started");
    console.log(window.innerHeight);


    const cardComponent = document.getElementById("card-component");
    const cardEdit = document.getElementById("edit-link");
    if (!cardComponent) return;



    if (!window.location.pathname.startsWith("/c/")) {
        cardEdit.style.display = "none"
        console.log('adsdadsa');
    };

    if (window.location.pathname.startsWith("/c/")) return;

    function updateCardHeight() {
        // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç–∏–ª–µ–π
        cardComponent.style.maxHeight = "";
        cardComponent.style.overflowY = "";

        // –†–∞—Å—Å—á–µ—Ç 90% –≤—ã—Å–æ—Ç—ã –æ–∫–Ω–∞
        const maxHeight = window.innerHeight * 0.87;

        // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –≤—ã—Å–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç - –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–∫—Ä–æ–ª–ª
        if (cardComponent.scrollHeight > maxHeight) {
            cardComponent.style.maxHeight = maxHeight + "px";
            cardComponent.style.overflowY = "auto";
        }
    }

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    updateCardHeight();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    window.addEventListener("resize", updateCardHeight);

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    const observer = new MutationObserver(updateCardHeight);
    observer.observe(cardComponent, {
        childList: true,
        subtree: true,
        characterData: true
    });

    // –î–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    if (!window.MutationObserver) {
        setInterval(updateCardHeight, 500);
    }
});
</script> -->

<script src="/static/collapse.js"></script>
